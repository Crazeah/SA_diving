<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„æ´»å‹• | æ½›æ°´ç¤¾</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%);
            min-height: 100vh;
        }

        .navbar-custom {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(33, 150, 243, 0.2);
        }

        .status-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-published {
            background: #4caf50;
            color: white;
        }

        .status-pending_review {
            background: #ff9800;
            color: white;
        }

        .status-drafting {
            background: #9e9e9e;
            color: white;
        }

        .status-cancelled {
            background: #f44336;
            color: white;
        }

        .status-ended {
            background: #607d8b;
            color: white;
        }

        .status-needs_revision {
            background: #e91e63;
            color: white;
        }

        .table-hover tbody tr:hover {
            background-color: #e3f2fd;
        }

        .btn-action {
            padding: 5px 10px;
            font-size: 0.85rem;
        }
    </style>
</head>

<body>

    <!-- å°èˆªåˆ— -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="/">ğŸŒŠ æ½›æ°´ç¤¾ç³»çµ±</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">é¦–é </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/activity/list">æ´»å‹•åˆ—è¡¨</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/activity/create">å»ºç«‹æ´»å‹•</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/activity/my-list">æˆ‘çš„æ´»å‹•</a>
                    </li>
                    <li class="nav-item" sec:authorize="hasRole('ADMIN')">
                        <a class="nav-link" href="/activity/audit/list">æ´»å‹•å¯©æ ¸</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/logout">ç™»å‡º</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="container py-5">
        <div class="row mb-4">
            <div class="col">
                <h1 class="fw-bold">ğŸ“‹ æˆ‘çš„æ´»å‹•</h1>
                <p class="text-muted">ç®¡ç†æ‚¨å»ºç«‹çš„æ‰€æœ‰æ´»å‹•</p>
            </div>
            <div class="col-auto">
                <a href="/activity/create" class="btn btn-primary btn-lg">
                    â• å»ºç«‹æ–°æ´»å‹•
                </a>
            </div>
        </div>

        <!-- æˆåŠŸ/éŒ¯èª¤è¨Šæ¯ -->
        <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
            <span th:text="${successMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <span th:text="${errorMessage}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- æ´»å‹•åˆ—è¡¨ -->
        <div class="card">
            <div class="card-body p-0">
                <!-- æ²’æœ‰æ´»å‹•æ™‚é¡¯ç¤º -->
                <div th:if="${#lists.isEmpty(activities)}" class="text-center py-5">
                    <h4 class="text-muted mb-3">ğŸ“­ æ‚¨é‚„æ²’æœ‰å»ºç«‹ä»»ä½•æ´»å‹•</h4>
                    <p class="text-muted">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹å»ºç«‹æ‚¨çš„ç¬¬ä¸€å€‹æ´»å‹•</p>
                    <a href="/activity/create" class="btn btn-primary btn-lg mt-3">
                        â• å»ºç«‹æ–°æ´»å‹•
                    </a>
                </div>

                <!-- æœ‰æ´»å‹•æ™‚é¡¯ç¤ºè¡¨æ ¼ -->
                <div th:if="${!#lists.isEmpty(activities)}">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>æ¨™é¡Œ</th>
                                <th>é¡åˆ¥</th>
                                <th>æ´»å‹•æ™‚é–“</th>
                                <th>ç‹€æ…‹</th>
                                <th>å»ºç«‹æ™‚é–“</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="activity : ${activities}">
                                <td class="fw-bold text-primary" th:text="'#' + ${activity.activityId}">#1</td>
                                <td>
                                    <strong th:text="${activity.title}">æ´»å‹•æ¨™é¡Œ</strong>
                                    <br>
                                    <small class="text-muted" th:text="'ğŸ“ ' + ${activity.location}">åœ°é»</small>
                                </td>
                                <td th:text="${activity.category}">é¡åˆ¥</td>
                                <td>
                                    <small
                                        th:text="${#temporals.format(activity.startTime, 'yyyy-MM-dd HH:mm')}">é–‹å§‹</small>
                                    <br>
                                    <small class="text-muted">~</small>
                                    <br>
                                    <small
                                        th:text="${#temporals.format(activity.endTime, 'yyyy-MM-dd HH:mm')}">çµæŸ</small>
                                </td>
                                <td>
                                    <span class="status-badge"
                                        th:classappend="'status-' + ${#strings.toLowerCase(activity.status.name())}"
                                        th:text="${activity.status.displayName}">ç‹€æ…‹</span>
                                    <!-- é¡¯ç¤ºé€€å›åŸå›  -->
                                    <div th:if="${activity.status.name() == 'NEEDS_REVISION'}" class="mt-1">
                                        <small class="text-danger"
                                            th:text="'âš ï¸ ' + ${activity.rejectionReason}">é€€å›åŸå› </small>
                                    </div>
                                </td>
                                <td th:text="${#temporals.format(activity.createdAt, 'yyyy-MM-dd HH:mm')}">å»ºç«‹æ™‚é–“</td>
                                <td>
                                    <div class="btn-group-vertical">
                                        <!-- å¯ç·¨è¼¯ç‹€æ…‹ï¼šè‰ç¨¿ã€éœ€ä¿®æ­£ -->
                                        <a th:if="${activity.status.name() == 'DRAFTING' or activity.status.name() == 'NEEDS_REVISION'}"
                                            th:href="@{/activity/edit/{id}(id=${activity.activityId})}"
                                            class="btn btn-outline-primary btn-action">
                                            âœï¸ ç·¨è¼¯
                                        </a>

                                        <!-- è‰ç¨¿ç‹€æ…‹å¯é€å¯© -->
                                        <form th:if="${activity.status.name() == 'DRAFTING'}"
                                            th:action="@{/activity/submit/{id}(id=${activity.activityId})}"
                                            method="POST" style="display: inline;">
                                            <button type="submit" class="btn btn-outline-success btn-action w-100">
                                                ğŸ“¤ é€å¯©
                                            </button>
                                        </form>

                                        <!-- éœ€ä¿®æ­£ç‹€æ…‹å¯é‡æ–°é€å¯© -->
                                        <form th:if="${activity.status.name() == 'NEEDS_REVISION'}"
                                            th:action="@{/activity/submit/{id}(id=${activity.activityId})}"
                                            method="POST" style="display: inline;">
                                            <button type="submit" class="btn btn-outline-warning btn-action w-100">
                                                ğŸ”„ é‡æ–°é€å¯©
                                            </button>
                                        </form>

                                        <!-- å·²ç™¼å¸ƒå¯å–æ¶ˆ -->
                                        <form th:if="${activity.status.name() == 'PUBLISHED'}"
                                            th:action="@{/activity/cancel/{id}(id=${activity.activityId})}"
                                            method="POST" style="display: inline;"
                                            onsubmit="return confirm('ç¢ºå®šè¦å–æ¶ˆæ­¤æ´»å‹•å—ï¼Ÿ');">
                                            <button type="submit" class="btn btn-outline-danger btn-action w-100">
                                                âŒ å–æ¶ˆ
                                            </button>
                                        </form>

                                        <!-- è‰ç¨¿ã€éœ€ä¿®æ­£å¯åˆªé™¤ -->
                                        <form
                                            th:if="${activity.status.name() == 'DRAFTING' or activity.status.name() == 'NEEDS_REVISION'}"
                                            th:action="@{/activity/delete/{id}(id=${activity.activityId})}"
                                            method="POST" style="display: inline;"
                                            onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤æ­¤æ´»å‹•å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼');">
                                            <button type="submit" class="btn btn-outline-danger btn-action w-100">
                                                ğŸ—‘ï¸ åˆªé™¤
                                            </button>
                                        </form>

                                        <!-- æŸ¥çœ‹è©³æƒ… -->
                                        <a th:href="@{/activity/{id}(id=${activity.activityId})}"
                                            class="btn btn-outline-secondary btn-action">
                                            ğŸ‘ï¸ æŸ¥çœ‹
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç‹€æ…‹èªªæ˜ -->
        <div class="card mt-4">
            <div class="card-header fw-bold">ğŸ“Š æ´»å‹•ç‹€æ…‹èªªæ˜</div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <span class="status-badge status-drafting">è‰ç¨¿</span>
                        <small class="ms-2 text-muted">å°šæœªé€å¯©çš„æ´»å‹•</small>
                    </div>
                    <div class="col-md-4">
                        <span class="status-badge status-pending_review">å¯©æ ¸ä¸­</span>
                        <small class="ms-2 text-muted">ç­‰å¾…ç®¡ç†å“¡å¯©æ ¸</small>
                    </div>
                    <div class="col-md-4">
                        <span class="status-badge status-needs_revision">éœ€ä¿®æ­£</span>
                        <small class="ms-2 text-muted">å·²é€€å›ï¼Œéœ€ä¿®æ”¹å¾Œé‡æ–°é€å¯©</small>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-4">
                        <span class="status-badge status-published">å·²ç™¼å¸ƒ</span>
                        <small class="ms-2 text-muted">æ´»å‹•å·²ä¸Šæ¶</small>
                    </div>
                    <div class="col-md-4">
                        <span class="status-badge status-ended">å·²çµæŸ</span>
                        <small class="ms-2 text-muted">æ´»å‹•å·²éæœŸ</small>
                    </div>
                    <div class="col-md-4">
                        <span class="status-badge status-cancelled">å·²å–æ¶ˆ</span>
                        <small class="ms-2 text-muted">æ´»å‹•å·²è¢«å–æ¶ˆ</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>